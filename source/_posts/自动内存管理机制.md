---
title: JVM-自动内存管理机制
date: 2017-03-07 13:25:24
categories: JVM
tags: [JVM]
comments: true
toc: true
---

**自动内存管理机制**



# **一、java内存区域与内存溢出异常**

java程序员把内存控制的权力交给了java虚拟机，有虚拟机来管理内存





## **1、运行时数据区域**

![img](C:/Users/user/AppData/Local/YNote/data/huanghy134@163.com/79ef5569dca54c5d9313205893a733d8/clipboard.png)

**线程私有的数据区**

### **1.1、程序计数器**

- 较小的内存空间，是当前线程所执行的字节码的行号指示器
- 用处：字节码解释器工作时通过改变这个计数器的值来选取下一条需要执行的字节码指令

- 每条线程都需要一个独立的程序计数器，是为了线程切换后能恢复到正确的执行位置，各条线程之间计数器互不影响，独立存储。
- 这类内存区域为“线程私有”的内存，是唯一一个在Java虚拟机规范中美而有规定任何OutOfMemoryError情况的区域

### **1.2、Java虚拟机栈**

- 线程私有，生命周期与线程相同

- 描述的是Java方法执行的内存模型。每个方法在执行的同时都会开辟一段内存区域用于存放方法运行时所需的数据，成为栈帧，一个栈帧包含如：局部变量表、操作数栈、动态链接、方法出口等信息。

**注意**：局部变量表所需的内存空间在编译期间完成分配。在方法运行的阶段是不会改							变局部变量表的大小的。

- 意义：每一个方法从调用直到执行完成的过程，就对应着一个栈帧在虚拟机栈中入栈和出栈的过程。
- 两个异常：

1.如果线程请求的深度大雨虚拟机所允许的深度，抛出StackOverFlowError异常

2.如果扩展时无法申请到足够的内存，就回抛出OutOfMemoryError异常

![img](C:/Users/user/AppData/Local/YNote/data/huanghy134@163.com/cd269a70260d477ead1d9bd58fbe5c67/clipboard.png)

### **1.3、本地方法栈**

**什么是本地方法？****为什么要使用本地方法？**

一个本地方法是这样一个方法：该方法的实现由非java语言实现，比如C语言实现。很多其它的编程语言都有这一机制，比如在C++中，你可以告知C++编译器去调用一个C语言编写的方法。 

我们知道java是高级编程语言，当对一些底层的如操作系统或某些硬件交换信息时，我们使用java来编程实现起来不容易，再者使用java来编程效率也很低下。这就不得不需要调用本地方法来解决这一问题。

**本地方法是如何工作的？**

![img](C:/Users/user/AppData/Local/YNote/data/huanghy134@163.com/0d9991789bd94a7d9816affe75fcd631/clipboard.png)

和虚拟机栈很相似，本地方法栈使用到的Native方法，会抛出StackOverFlowError异常、OutOfMemoryError异常

**所有线程共有的数据区**

### **1.4、Java堆**

- 是在虚拟机启动时创建；存放着对象实例
- 异常：如果堆中没有内存完成实例分配，并且堆也无法再扩展时，将会抛出OutOfMemoryError异常
- 是垃圾收集器管理的主要区域；Java堆中还可以细分为：新生代和老年代

### **1.5、方法区**

![img](C:/Users/user/AppData/Local/YNote/data/huanghy134@163.com/9257d7db1f794b029c78b70273e63a65/clipboard.png)

- 用于存储虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据
- 可以不选择垃圾收集
- 异常：如果方法去中没有内存完成实例分配，并且方法区也无法再扩展时，将会抛出OutOfMemoryError异常

### **1.6、运行时常量池**

- 是方法区的一部分

**需要理清楚的区别：**

- 常量池（Constant Pool）：常量池数据编译期被确定，是Class文件中的一部分。存储了类、方法、接口等中的常量，当然也包括字符串常量。
- 字符串池/字符串常量池（String Pool/String Constant Pool）：是常量池中的一部分，存储编译期类中产生的字符串类型数据。
- 运行时常量池（Runtime Constant Pool）：方法区的一部分，所有线程共享。**虚拟机加载Class后把常量池中的数据放入到运行时常量池。**



常量池中主要存放两大类常量：字面量（Literal）和符号引用（Symbolic Reference）。

- 字面量：文本字符串、声明为final的常量值等；
- 符号引用：类和接口的完全限定名（Fully Qualified Name）、字段的名称和描述符（Descriptor）、方法的名称和描述符